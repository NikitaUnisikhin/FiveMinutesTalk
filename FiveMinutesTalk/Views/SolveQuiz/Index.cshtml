@using FiveMinutesTalk.Domain.Entities.QuestionsTypes
@model Guid[]

@{
    ViewData["Title"] = "Прохождение опроса";
}

<script>
    function checkCheckbox(checkbox, optionNumber){
        if (checkbox.checked) {
            checkbox.value = optionNumber;
        }
        else {
            checkbox.value = -1;
        }
    }
</script>
<div class="text-center">
    <h2 class="name-poll" style="position: relative">@ViewBag.QuizTitle</h2>
    <form method="post" asp-controller="SolveQuiz" asp-action="SaveResult">
        @{
            var questionNumber = 0;
            foreach (var id in Model)
            {
                var question = (Question)ViewBag.DataMangager.Questions.GetItemById(id);
                <input type="text" readonly name="answers[@questionNumber].QuestionId" value="@question.Id" hidden="hidden">
                <input type="text" readonly name="answers[@questionNumber].QuestionType" value="@question.Type" hidden="hidden">
                <input type="text" readonly name="answers[@questionNumber].QuizId" value="@ViewBag.QuidId" hidden="hidden">
                var questionContainerId = $"question_{questionNumber}";
                <section class="question-solve">
                    <section id=@questionContainerId class="hat-question">
                        <div class="number-question">
                            <div class="number">@(questionNumber + 1)</div>
                            <div class="dot">.</div>
                        </div>
                        <div class="name-question">@question.Text</div>
                    </section>
                    <div class="answer">
                        @switch (question.Type)
                        {
                            case QuestionTypeEnum.OpenQuestion:
                            {
                                var inputId = $"answer_{questionNumber}";
                                <label>
                                    <input class="text-question" type="text" id=@inputId placeholder="Ответ"
                                           name="answers[@questionNumber].Answers">
                                </label>
                                break;
                            }
                            case QuestionTypeEnum.MultipleAnswersQuestion:
                            {
                                <label>
                                    @{
                                        var optionNumber = 0;
                                        foreach (var option in question.AnswerOptions)
                                        {
                                            var optionId = $"option_{questionNumber}_{optionNumber}";
                                            <label id=@optionId class="checkbox-label">
                                                <input type="checkbox"
                                                       onchange="checkCheckbox(this, @optionNumber)"
                                                       name="answers[@questionNumber].Answers"
                                                       value=-1
                                                       class="checkbox-text">
                                                <span>@option</span>
                                            </label>
                                            optionNumber++;
                                        }
                                    } 
                                </label>
                                break;
                            }
                        }
                    </div>
                </section>
                questionNumber++;
            }
            <button class="submit-button" id="send-answers">Отправить</button>
        }

    </form>
</div>